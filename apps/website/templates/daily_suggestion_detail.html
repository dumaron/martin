{% extends 'base.html' %}

{% block content %}
    <div class="fixed-content">
        <h1>Daily suggestions for {{ date }}</h1>

        {% if is_in_the_past %}
            {% if daily_suggestion %}
                <textarea name="content" rows="24" cols="80" disabled>{{ daily_suggestion.content|default:"" }}
                </textarea>
            {% else %}
                No daily suggestion was created on {{ date }}
            {% endif %}
        {% else %}
        <form method="post" action="{% url 'daily_suggestions_editor_page.actions.save_daily_suggestion' date=date %}">
            {% csrf_token %}
            <div>
                <textarea name="content" rows="24" cols="80">{{ daily_suggestion.content|default:'' }}</textarea>
            </div>
            <button type="submit">Save</button>
        </form>
        <div>
            <a href="{% url 'daily_suggestions_editor_page.actions.daily_suggestion_pdf' date=date %}">Download PDF</a>
        </div>
        {% endif %}
    </div>
    <div id="suggestions">
    {% if active_recurring_suggestions %}
        <div>
            <div class="title">Recurring suggestions</div>
            <table>
            <tbody>
            {% for suggestion in active_recurring_suggestions %}
                <tr>
                    <td>{{ suggestion.content }}</td>
                    <td style="width: 10px;">
                        <button type="button" onclick="addSuggestion('{{ suggestion.content|escapejs }}')">Add</button>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
            </table>
        </div>
    {% endif %}
    </div>
    <script type="text/javascript">
        /*
        Here we break with the hypermedia philosophy.
        In hypermedia, I think that the canonical way to implement this feature would be to save the textarea form,
        append the suggestion to its content, and refresh the page.

        While I get it, and I think it is a fine way to do so, I also have some doubts. After all, why re-render
        everything, making a dozen SQL queries again, for something that could be achieved with a little Javascript?

        But I think my understanding of hypermedia here is just exaggerated. Like with many things, when you want to
        correct something, you might end up over-correcting it. In the old days, before SPAs became a thing, having
        small pieces of Javascript here and there to save resources and time were not considered a bad practice. On the
        contrary, it was welcome!

        With memory of the old technologies, we also lost the compromises that we made along the way to make better
        software. It's so mentally rewarding to re-discover them, like remembering an important thing you already
        learned more than 15 years ago.

        Ok, back to code.
        */
        function addSuggestion(suggestion) {
            const textarea = document.querySelector('textarea[name="content"]');
            textarea.value += '\n[ ] ' + suggestion;
        }
    </script>
{% endblock %}