{% extends "base.html" %}

{% block stylesheets %}
    <style>
        .creation-form-label {
            width: 150px;
        }
        .processing-section {
            margin-bottom: 2rem;
        }
    </style>
{% endblock %}

{% block title %}Process Inbox - GTD Flow{% endblock %}

{% block content %}
    <div class="fixed-content">
        <h1 class="mono">Processing inbox item #{{ inbox.id }}</h1>
        
        <table class="large">
            <tbody>
                <tr>
                    <th>ID</th>
                    <td class="mono">{{ inbox.id }}</td>
                </tr>
                <tr>
                    <th>Content</th>
                    <td class="emphasis">{{ inbox.content }}</td>
                </tr>
                <tr>
                    <th>Created</th>
                    <td>{{ inbox.created_at|date:"d.m.Y H:i" }}</td>
                </tr>
                <tr>
                    <th>Status</th>
                    <td>{% if inbox.processed %}âœ“ Processed{% else %}â—¯ Unprocessed{% endif %}</td>
                </tr>
            </tbody>
        </table>

        <div class="processing-section">
            <h2>ðŸ“‚ Create New Project</h2>
            <p>Turn this inbox item into a new project</p>
            <form action="{% url 'process_inbox_item' inbox.id %}" method="post" class="pairing-form">
                {% csrf_token %}
                <input type="hidden" name="action" value="create_project">
                <table class="large">
                    <tbody>
                        <tr>
                            <th class="creation-form-label">Project Title</th>
                            <td>
                                <input type="text" name="project_title" required placeholder="Enter project title" style="width: 100%; max-width: 400px;">
                            </td>
                        </tr>
                        <tr>
                            <th class="creation-form-label">Description</th>
                            <td>
                                <textarea name="project_description" rows="2" placeholder="Optional project description" style="width: 100%; max-width: 400px;"></textarea>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button type="submit">Create Project</button>
            </form>
        </div>

        {% if projects %}
        <div class="processing-section">
            <h2>âœ… Add Task to Existing Project</h2>
            <p>Turn this inbox item into a task for an existing project</p>
            <form action="{% url 'process_inbox_item' inbox.id %}" method="post" class="pairing-form">
                {% csrf_token %}
                <input type="hidden" name="action" value="create_task">
                <table class="large">
                    <tbody>
                        <tr>
                            <th class="creation-form-label">Project</th>
                            <td>
                                <select name="project_id" required class="tom-select" style="width: 100%; max-width: 400px;">
                                    <option value="">Choose a project...</option>
                                    {% for project in projects %}
                                        <option value="{{ project.id }}">{{ project.title }} ({{ project.get_status_display }})</option>
                                    {% endfor %}
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th class="creation-form-label">Task Title</th>
                            <td>
                                <input type="text" name="task_title" required placeholder="Enter task title" style="width: 100%; max-width: 400px;">
                            </td>
                        </tr>
                        <tr>
                            <th class="creation-form-label">Task Description</th>
                            <td>
                                <textarea name="task_description" rows="2" placeholder="Optional task description" style="width: 100%; max-width: 400px;"></textarea>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button type="submit">Create Task</button>
            </form>
        </div>
        {% else %}
        <div class="processing-section">
            <h2>âœ… Add Task to Project</h2>
            <p>No active projects available. <a href="{% url 'project_create' %}">Create a project first</a>.</p>
        </div>
        {% endif %}

        <div class="processing-section">
            <h2>âœ“ Mark as Processed</h2>
            <p>This item doesn't require any action - mark it as processed without creating anything</p>
            <form action="{% url 'process_inbox_item' inbox.id %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="mark_done">
                <button type="submit">Mark as Processed</button>
            </form>
        </div>

        <div class="processing-section">
            <h2>Skip for Now</h2>
            <p>Go back to inbox list or process another item</p>
            <form action="{% url 'inbox_list' %}" method="get">
                <button type="submit">Back to Inbox</button>
            </form>
        </div>
    </div>
{% endblock %}